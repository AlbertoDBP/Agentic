```mermaid
erDiagram
    USERS ||--o{ PORTFOLIOS : owns
    USERS ||--o{ AUDIT_LOG : generates
    PORTFOLIOS ||--o{ POSITIONS : contains
    PORTFOLIOS ||--o{ TRANSACTIONS : records
    PORTFOLIOS ||--o{ ALERTS : receives
    PORTFOLIOS ||--o{ INCOME_METRICS : tracks
    TICKERS ||--o{ POSITIONS : "referenced by"
    TICKERS ||--o{ INCOME_SCORES : has
    TICKERS ||--o{ FEATURE_SNAPSHOTS : has
    TICKERS ||--o{ NAV_SNAPSHOTS : "has (ETFs)"
    TICKERS ||--o{ DIVIDEND_HISTORY : records
    ADVISORS ||--o{ NEWSLETTERS : publishes
    NEWSLETTERS ||--o{ NEWSLETTER_SECTIONS : contains
    NEWSLETTERS ||--o{ NEWSLETTER_RECOMMENDATIONS : contains
    NEWSLETTERS ||--o{ NEWSLETTER_THEMES : contains
    NEWSLETTERS ||--o{ NEWSLETTER_EMBEDDINGS : has
    ADVISORS ||--o{ ADVISOR_PHILOSOPHY_SNAPSHOTS : evolves
    TICKERS ||--o{ NEWSLETTER_RECOMMENDATIONS : mentioned_in
    
    USERS {
        uuid id PK
        text email UK
        text name
        text role "free, premium, advisor, admin"
        jsonb preferences "alert_thresholds, notification_channels"
        decimal tax_bracket
        text state "for state tax calculations"
        timestamptz created_at
        timestamptz last_login
    }
    
    PORTFOLIOS {
        uuid id PK
        uuid user_id FK
        text name
        text account_type "IRA, 401K, Taxable, Roth"
        decimal goal_yield "target annual yield %"
        text risk_tolerance "conservative, moderate, aggressive"
        jsonb target_allocations "sector weights, position limits"
        timestamptz created_at
        timestamptz last_rebalanced_at
    }
    
    POSITIONS {
        uuid id PK
        uuid portfolio_id FK
        uuid ticker_id FK
        decimal shares
        decimal cost_basis "avg cost per share"
        date acquisition_date "oldest lot date"
        timestamptz last_updated
    }
    
    TRANSACTIONS {
        uuid id PK
        uuid portfolio_id FK
        uuid ticker_id FK
        text transaction_type "buy, sell, dividend, reinvest"
        decimal shares
        decimal price
        decimal fee
        date transaction_date
        text tax_lot_id "for wash sale tracking"
        timestamptz created_at
    }
    
    TICKERS {
        uuid id PK
        text symbol UK "JEPI, XYLD, etc"
        text name
        text asset_class "equity, covered_call_etf, reit, bdc"
        text sector "Technology, Financials, etc"
        text exchange "NYSE, NASDAQ"
        boolean is_active
        jsonb metadata "expense_ratio, aum, inception_date"
        timestamptz created_at
    }
    
    FEATURE_SNAPSHOTS {
        uuid id PK
        uuid ticker_id FK
        date as_of_date
        decimal yield_trailing_12m
        decimal yield_forward
        decimal div_cagr_1y
        decimal div_cagr_3y
        decimal div_cagr_5y
        decimal payout_ratio
        decimal volatility_1y
        decimal max_drawdown_1y
        decimal max_drawdown_3y
        decimal beta_equity
        decimal beta_sector
        decimal fcf_to_debt
        decimal roe
        decimal interest_coverage
        decimal pe_ratio
        decimal pe_vs_sector_z
        decimal ev_ebitda
        int advisor_coverage_count
        decimal advisor_net_buy_signal "-1 to +1"
        decimal missing_feature_ratio
        int days_since_ipo
        jsonb raw_features "all 50+ features as JSON"
        timestamptz created_at
    }
    
    INCOME_SCORES {
        uuid id PK
        uuid ticker_id FK
        date as_of_date
        text model_version "income_score_v3"
        decimal score "0 to 1"
        text grade "A, B, C, D, F"
        jsonb factor_scores "{yield_quality: 85, stability: 70, ...}"
        text[] flags "recent_div_cut, high_payout, illiquid"
        decimal confidence "0 to 1"
        jsonb shap_values "feature importance from XGBoost"
        timestamptz created_at
    }
    
    NAV_SNAPSHOTS {
        uuid id PK
        uuid ticker_id FK
        date snapshot_date
        decimal nav "net asset value per share"
        decimal market_price
        decimal premium_discount "% over/under NAV"
        decimal nav_change_1m "%"
        decimal nav_change_3m "%"
        decimal nav_change_6m "%"
        decimal nav_change_12m "%"
        decimal upside_capture_ratio "vs benchmark"
        timestamptz created_at
    }
    
    DIVIDEND_HISTORY {
        uuid id PK
        uuid ticker_id FK
        decimal amount "per share"
        date ex_date
        date pay_date
        text frequency "monthly, quarterly, annual"
        text tax_treatment "qualified, ordinary, roc, section_1256"
        boolean special_dividend
        timestamptz created_at
    }
    
    ALERTS {
        uuid id PK
        uuid portfolio_id FK
        uuid ticker_id FK "nullable"
        text alert_type "div_cut, nav_erosion, concentration, entry_zone, tax_inefficient"
        text severity "LOW, MEDIUM, HIGH, CRITICAL"
        text message
        text recommended_action
        jsonb context "{current_value, threshold, historical_avg, ...}"
        timestamptz created_at
        text user_action "dismissed, snoozed, acted, null"
        timestamptz user_action_at
        boolean ml_generated "true if Agent 11 classified as useful"
        decimal ml_confidence "0 to 1"
    }
    
    INCOME_METRICS {
        uuid id PK
        uuid portfolio_id FK
        text period "YYYY-MM"
        decimal total_income "$ received"
        decimal yield_on_cost "% based on cost basis"
        decimal forward_yield "% based on current prices"
        decimal income_growth_rate "% vs prior period"
        jsonb income_by_ticker "[{ticker, amount, yield}, ...]"
        timestamptz created_at
    }
    
    ADVISORS {
        uuid id PK
        text name "The REIT Forum, High Yield Landlord, etc"
        text source "seeking_alpha, substack, newsletter"
        text email "for email parsing"
        text focus "income, growth, value, etc"
        jsonb metadata "{subscription_tier, coverage_sectors, ...}"
        timestamptz created_at
    }
    
    NEWSLETTERS {
        uuid id PK
        uuid advisor_id FK
        text subject
        timestamp published_at
        timestamp received_at
        text source "email, api, scrape"
        text status "raw, parsed, extracted, error"
        text raw_format "html, text, pdf"
        jsonb provider_metadata "labels, categories, campaign_id"
        timestamptz created_at
    }
    
    NEWSLETTER_RAW_CONTENT {
        uuid newsletter_id PK_FK
        text raw_html
        text raw_text
        jsonb raw_attachments "[{filename, url, type}, ...]"
        timestamptz created_at
    }
    
    NEWSLETTER_SECTIONS {
        uuid id PK
        uuid newsletter_id FK
        int section_index
        text section_type "intro, macro, stock_idea, housekeeping, disclaimer"
        text title
        text body_text "cleaned, de-HTMLed"
        int tokens_estimate
        jsonb section_metadata "{heading_level, html_id, ...}"
        timestamptz created_at
    }
    
    NEWSLETTER_RECOMMENDATIONS {
        uuid id PK
        uuid newsletter_id FK
        uuid section_id FK "nullable"
        uuid ticker_id FK
        text original_symbol "as written in newsletter"
        text action "buy, add, hold, trim, sell, watch"
        text time_horizon "short, medium, long"
        decimal confidence "0 to 1"
        text entry_guidance_text "author's suggested entry price/range"
        text rationale "brief explanation from newsletter"
        boolean llm_extracted
        int extraction_version
        jsonb extraction_metadata "{model, prompt_id, quality_score, ...}"
        timestamptz created_at
    }
    
    NEWSLETTER_THEMES {
        uuid id PK
        uuid newsletter_id FK
        text theme_type "macro, sector, factor, risk"
        text label "higher-for-longer, REIT repricing, etc"
        text summary
        boolean llm_extracted
        decimal importance "0 to 1"
        timestamptz created_at
    }
    
    NEWSLETTER_EMBEDDINGS {
        uuid id PK
        uuid newsletter_id FK
        uuid section_id FK "nullable, for section-level embeddings"
        vector(1536) embedding "OpenAI ada-002"
        text model "text-embedding-ada-002"
        text purpose "semantic_search, classification"
        timestamptz created_at
    }
    
    ADVISOR_PHILOSOPHY_SNAPSHOTS {
        uuid id PK
        uuid advisor_id FK
        uuid as_of_newsletter_id FK
        date snapshot_date
        jsonb philosophy_json "{factor_weights, risk_tolerance, style_tags, ...}"
        text notes "human-readable summary"
        decimal confidence "0 to 1"
        uuid[] source_newsletter_ids "newsletters used to derive philosophy"
        timestamptz created_at
    }
    
    AGENT_RUNS {
        uuid id PK
        text agent_name "market_data_sync, income_scoring, etc"
        text trigger_type "scheduled, webhook, manual"
        jsonb input_params "{ticker, as_of_date, portfolio_id, ...}"
        jsonb output_data "{scores, alerts_generated, ...}"
        text status "running, success, failed"
        timestamptz start_time
        timestamptz end_time
        text error_message "if failed"
        int cost_tokens "LLM token usage"
        decimal cost_usd
        timestamptz created_at
    }
    
    AUDIT_LOG {
        uuid id PK
        uuid user_id FK
        text action "view_portfolio, add_position, delete_alert, update_settings"
        text resource_type "portfolio, position, alert, user"
        uuid resource_id "nullable"
        inet ip_address
        text user_agent
        jsonb request_details "HTTP method, endpoint, params"
        timestamptz timestamp
    }
    
    MODEL_REGISTRY {
        uuid id PK
        text model_name "income_score, alert_classifier, scenario_glm"
        text version "v1, v2, v3"
        text algorithm "xgboost, elasticnet, lstm"
        date train_start_date
        date train_end_date
        jsonb hyperparameters "{n_estimators: 500, learning_rate: 0.05, ...}"
        jsonb evaluation_metrics "{auc: 0.82, precision: 0.75, ...}"
        text status "candidate, production, deprecated"
        text artifact_path "s3://models/income_score_v3.pkl"
        timestamptz created_at
        timestamptz promoted_at "when moved to production"
    }
```
